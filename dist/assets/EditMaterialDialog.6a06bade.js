import{u as E,R,a as D,r as h,b as Q,m as I,I as f,j as N,E as F,c as l,T as Z,d as G,e as _,f as X,g as V,h as q,i as z,k as H,C as W,l as ee,n as te,s as se,o as j,p as U,q as ae,A as P,M as b,D as K,t as ue,v as Y,S as ne,w as oe,x as ce,y as re,F as ie}from"./index.99da335b.js";import de from"./EditSpecificationDialog.c69a62e6.js";function le(){var S,M,y,O;const{permissions:g}=E(_),s=g.get(R.MATERIALS_DB),a=D(X),o=D(V),n=D(q),t=E(z),r=E(H),T=h.exports.useMemo(()=>[...t.keys()][0]||0,[t]),[d,k]=h.exports.useState(T),p=Q(d),L=["\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435","\u041A\u043E\u0434","\u0422\u0438\u043F"],x=[];t.forEach((i,m)=>x.push({key:m,data:[i.name,i.code,r.get(i.char_type_id)]}));const v=[{caption:"\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435:",value:((S=t.get(d))==null?void 0:S.name)||"",message:I.ENTER_CAPTION,type:f.TEXT},{caption:"\u041A\u043E\u0434:",value:((M=t.get(d))==null?void 0:M.code)||"",message:I.ENTER_CODE,type:f.TEXT},{caption:"\u0422\u0438\u043F:",value:((y=t.get(d))==null?void 0:y.char_type_id)||0,valueCaption:i=>r.get(i)||"",list:[...r.keys()],message:"",type:f.LIST},{caption:"\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435:",value:p||"",message:I.ENTER_IMAGE,type:f.FILE}];return N(F,{children:[l("div",{children:l(Z,{heads:L,content:x,onSelectKey:i=>{k(i)}})}),s!=null&&s.Read?l(G,{name:(O=t.get(d))==null?void 0:O.name,items:v,onUpdate:s!=null&&s.Update?async(i,m)=>{const c=i[0]?m[0]:"",e=i[1]?m[1]:"",u=i[2]?m[2]:0,A=i[3]?m[3]:"";return await a({id:d,char_type_id:u,name:c,code:e,image:A})}:void 0,onDelete:s!=null&&s.Delete?async()=>{const i=await n(d);return k([...t.keys()][0]||0),i}:void 0,onAdd:s!=null&&s.Create?async(i,m)=>{const c=i[0]?m[0]:"",e=i[1]?m[1]:"",u=i[2]?m[2]:0,A=i[3]?m[3]:"";return await o({name:c,char_type_id:u,code:e,image:A})}:void 0}):l("div",{})]})}function ge(){var i,m;const{permissions:g}=E(_),s=D(ee),a=D(te),o=g.get(R.MATERIALS_DB),n=E(se),t=E(z),r=E(j),T=h.exports.useMemo(()=>[...n.keys()][0]||0,[n]),[d,k]=h.exports.useState(T),p=h.exports.useMemo(()=>r.filter(c=>c.id===d).map(c=>c.charId),[r,d]),L=[...t.keys()].filter(c=>{var e,u;return((e=t.get(c))==null?void 0:e.char_type_id)===((u=n.get(d))==null?void 0:u.charType)}),x=h.exports.useMemo(()=>p[0]||0,[p]),[v,S]=h.exports.useState(x),M=["\u041D\u0430\u0438\u043C\u0435\u043D\u043E\u0432\u0430\u043D\u0438\u0435","\u041A\u043E\u0434"],y=[];p.forEach(c=>{var e,u;return y.push({key:c,data:[(e=t.get(c))==null?void 0:e.name,(u=t.get(c))==null?void 0:u.code]})});const O=[{caption:"\u0425\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0430:",value:v,valueCaption:c=>{var e;return((e=t.get(c))==null?void 0:e.name)||""},list:L,message:I.ENTER_CAPTION,type:f.LIST}];return h.exports.useEffect(()=>{S(p[0]||0)},[p]),N(F,{children:[N("div",{children:[l("div",{className:"d-flex flex-nowrap gap-2 align-items-start",children:l(W,{title:"\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430: ",value:d,items:[...n.keys()],displayValue:c=>{var e;return((e=n.get(c))==null?void 0:e.name)||""},onChange:(c,e)=>{k(e)}})}),l("hr",{}),y.length>0&&l(Z,{heads:M,content:y,onSelectKey:c=>{S(c)}})]}),(o==null?void 0:o.Read)&&y.length>0?l(G,{name:((i=n.get(d))==null?void 0:i.name)+""+((m=t.get(v))==null?void 0:m.name),items:O,onDelete:o!=null&&o.Delete?async()=>{const c=await a({id:d,charId:v});return S(p[0]||0),c}:void 0,onAdd:o!=null&&o.Create?async(c,e)=>{const u=e[0];return r.find(C=>C.charId===u)?{success:!1,message:I.MATERIAL_EXIST}:await s({id:d,charId:u})}:void 0}):l("div",{})]})}const J=U(new Map),B=U(null,async(g,s)=>{var n;const{token:a,permissions:o}=g(_);if(!((n=o.get(R.MATERIALS))!=null&&n.Read))return{success:!1,message:""};try{const t=await ae(`${P}${b}${K}?token=${a}`);t.success&&s(J,ue(t.data))}catch(t){console.error(t)}}),me=U(null,async(g,s,a)=>{var t;const{token:o,permissions:n}=g(_);if(!((t=n.get(R.MATERIALS))!=null&&t.Delete))return{success:!1,message:""};try{const r=await Y(`${P}${b}${K}`,"DELETE",JSON.stringify({id:a,token:o}));return await s(B),{success:r.success,message:r.message}}catch(r){return console.error(r),{success:!1,message:I.QUERY_ERROR}}}),pe=U(null,async(g,s,a)=>{var t;const{token:o,permissions:n}=g(_);if(!((t=n.get(R.MATERIALS))!=null&&t.Create))return{success:!1,message:""};try{const r=await Y(`${P}${b}${K}`,"POST",JSON.stringify({data:a,token:o}));return await s(B),{success:r.success,message:r.message}}catch(r){return console.error(r),{success:!1,message:I.QUERY_ERROR}}}),Ee=U(null,async(g,s,a)=>{var t;const{token:o,permissions:n}=g(_);if(!((t=n.get(R.MATERIALS))!=null&&t.Update))return{success:!1,message:""};try{const r=await Y(`${P}${b}${K}`,"PUT",JSON.stringify({data:a,token:o}));return await s(B),{success:r.success,message:r.message}}catch(r){return console.error(r),{success:!1,message:I.QUERY_ERROR}}});function he(){var c;const{permissions:g}=E(_),s=D(B),a=g.get(R.MATERIALS),o=E(J),n=E(z),t=E(ce),T=E(j).filter(e=>e.id===ne.DSP16).map(e=>e.charId),d=t.filter(e=>e.char_type_id===oe.COLOR).map(e=>e.id),k=()=>o.keys().next().value||0,[p,L]=h.exports.useState(k()),{kromkaId:x,zaglushkaId:v}=o.get(p)||{kromkaId:0,zaglushkaId:0},S=D(me),M=D(pe),y=D(Ee),O=["\u0414\u0421\u041F","\u041A\u0440\u043E\u043C\u043A\u0430","\u0417\u0430\u0433\u043B\u0443\u0448\u043A\u0430"],i=[];o.forEach((e,u)=>{var A,C,w;return i.push({key:u,data:[(A=n.get(u))==null?void 0:A.name,(C=n.get(e.kromkaId))==null?void 0:C.name,(w=n.get(e.zaglushkaId))==null?void 0:w.name]})});const m=[{caption:"\u0414\u0421\u041F:",value:p,valueCaption:e=>{var u;return((u=n.get(e))==null?void 0:u.name)||""},message:I.ENTER_CAPTION,type:f.LIST,list:T},{caption:"\u041A\u0440\u043E\u043C\u043A\u0430:",value:x,valueCaption:e=>{var u;return((u=n.get(e))==null?void 0:u.name)||""},message:I.ENTER_CODE,type:f.LIST,list:d},{caption:"\u0417\u0430\u0433\u043B\u0443\u0448\u043A\u0430:",value:v,valueCaption:e=>{var u;return((u=n.get(e))==null?void 0:u.name)||""},message:I.ENTER_CODE,type:f.LIST,list:d}];return h.exports.useEffect(()=>{s()},[a==null?void 0:a.Read]),N(F,{children:[l(Z,{heads:O,content:i,onSelectKey:e=>{L(e)}}),a!=null&&a.Read?l(G,{name:(c=n.get(p))==null?void 0:c.name,items:m,onUpdate:a!=null&&a.Update?async(e,u)=>{const A=e[1]?u[1]:0,C=e[2]?u[2]:0;return await y({id:p,kromkaId:A,zaglushkaId:C})}:void 0,onAdd:a!=null&&a.Create?async(e,u)=>{const A=u[0],C=u[1],w=u[2];return await M({id:A,kromkaId:C,zaglushkaId:w})}:void 0,onDelete:a!=null&&a.Delete?async()=>{const e=await S(p);return L(k()),e}:void 0}):l("div",{})]})}const $=new Map;$.set(1,"\u041D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440\u0430");$.set(2,"\u0425\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438");$.set(3,"\u0425\u0430\u0440\u0430\u043A\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043A\u0438 \u043D\u043E\u043C\u0435\u043D\u043A\u043B\u0430\u0442\u0443\u0440");$.set(4,"\u0414\u0421\u041F - \u041A\u0440\u043E\u043C\u043A\u0430 - \u0417\u0430\u0433\u043B\u0443\u0448\u043A\u0430");function ye(){const g=re(),{permissions:s}=E(_),a=s.get(R.SPECIFICATION),[o,n]=h.exports.useState(1),t=[...$.entries()].map((T,d)=>l("div",{className:o===T[0]?"tab-button-active":"tab-button-inactive",onClick:()=>{n(T[0])},role:"button",children:T[1]},d)),r=Ae(o);return h.exports.useEffect(()=>{a!=null&&a.Read||g("/")},[a]),N("div",{className:"database-edit-container",children:[l("div",{className:"tab-header-container",children:t}),r]})}function Ae(g){const s=new Map;return s.set(1,l(de,{})),s.set(2,l(le,{})),s.set(3,l(ge,{})),s.set(4,l(he,{})),s.get(g)||l(ie,{})}export{ye as default};
